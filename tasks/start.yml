---
- name: Start | import common tasks
  tags: ceph
  ansible.builtin.import_tasks: "common.yml"

- name: Start | start monitor service
  tags: ceph
  when: inventory_hostname in groups['ceph_mon']
  block:
    - name: Start | start service
      ansible.builtin.service:
        name: "ceph-mon.target"
        state: "started"
      become: true
      register: start_service
      failed_when: start_service.failed
    - name: Start | wait until port is opened
      ansible.builtin.wait_for:
        host: "{{ hostvars[inventory_hostname]['ansible_' + ceph_public_network_iface].ipv4.address }}"
        port: "{{ ceph_mon_port }}"
        sleep: 2
        timeout: 10
        state: started

- name: Start | start manager service
  tags: ceph
  ansible.builtin.service:
    name: "ceph-mgr.target"
    state: "started"
  become: true
  register: start_service
  failed_when: start_service.failed
  when: inventory_hostname in groups['ceph_mgr']

- name: Start | start osd service
  tags: ceph
  ansible.builtin.service:
    name: "ceph-osd.target"
    state: "started"
  become: true
  register: start_service
  failed_when: start_service.failed
  when: inventory_hostname in groups['ceph_osd']
...
